arch snes.cpu
include "snes.inc"

macro seek(variable offset) {
  origin ((offset & $7F0000) >> 1) | (offset & $7FFF)
  base offset
}

seek($008000)


reset:
    sei                 // $008000
    jsr sub_00822B      // $008001

    rep #$30            // $008004
    stz {OAMADDL}       // $008006
    sep #$30            // $008009
    ldx #$80            // $00800B

loc_00800D:
    lda #$0A            // $00800D
    sta {OAMDATA}       // $00800F
    lda #$F0            // $008012
    sta {OAMDATA}       // $008014
    sta {OAMDATA}       // $008017
    sta {OAMDATA}       // $00801A
    dex                 // $00801D
    bne loc_00800D      // $00801E

    ldx #$20            // $008020
    lda #$55            // $008022

loc_008024:
    sta {OAMDATA}       // $008024
    dex                 // $008027
    bne loc_008024      // $008028

    rep #$30            // $00802A
    sep #$20            // $00802C
    stz {CGADD}         // $00802E
    ldx #$2200          // $008031
    stx {DMAP0}         // $008034
    ldx #$82E6          // $008037
    stx {A1T0L}         // $00803A
    lda #$00            // $00803D
    sta {A1B0}          // $00803F
    ldx #$0200          // $008042
    stx {DAS0}          // $008045
    lda #$01            // $008048
    sta {MDMAEN}        // $00804A
    lda #$80            // $00804D
    sta {VMAIN}         // $00804F
    ldx #$0000          // $008052
    stx {VMADDL}        // $008055
    ldx #$1801          // $008058
    stx {DMAP0}         // $00805B
    ldx #$87A6          // $00805E
    stx {A1T0L}         // $008061
    lda #$00            // $008064
    sta {A1B0}          // $008066
    ldx #$0800          // $008069
    stx {DAS0}          // $00806C
    lda #$01            // $00806F
    sta {MDMAEN}        // $008071
    lda #$80            // $008074
    sta {VMAIN}         // $008076
    ldx #$1000          // $008079
    stx {VMADDL}        // $00807C
    ldx #$1801          // $00807F
    stx {DMAP0}         // $008082
    ldx #$84E6          // $008085
    stx {A1T0L}         // $008088
    lda #$00            // $00808B
    sta {A1B0}          // $00808D
    ldx #$02C0          // $008090
    stx {DAS0}          // $008093
    lda #$01            // $008096
    sta {MDMAEN}        // $008098
    lda #$80            // $00809B
    sta {VMAIN}         // $00809D
    ldx #$4000          // $0080A0
    stx {VMADDL}        // $0080A3
    ldx #$1801          // $0080A6
    stx {DMAP0}         // $0080A9
    ldx #$8FA6          // $0080AC
    stx {A1T0L}         // $0080AF
    lda #$00            // $0080B2
    sta {A1B0}          // $0080B4
    ldx #$0680          // $0080B7
    stx {DAS0}          // $0080BA
    lda #$01            // $0080BD
    sta {MDMAEN}        // $0080BF
    lda #$22            // $0080C2
    sta {OBSEL}         // $0080C4
    lda #$11            // $0080C7
    sta {BGMODE}        // $0080C9
    lda #$00            // $0080CC
    sta {BG1SC}         // $0080CE
    lda #$01            // $0080D1
    sta {BG12NBA}       // $0080D3
    lda #$11            // $0080D6
    sta {TM}            // $0080D8
    stz $0C             // $0080DB
    lda #$05            // $0080DD
    sta $04             // $0080DF
    lda #$E6            // $0080E1
    sta $06             // $0080E3
    lda #$32            // $0080E5
    sta $00             // $0080E7
    lda #$40            // $0080E9
    sta $01             // $0080EB
    lda #$02            // $0080ED
    sta $03             // $0080EF
    sta $02             // $0080F1
    lda #$0F            // $0080F3
    sta {INIDISP}       // $0080F5
    lda #$81            // $0080F8
    sta {NMITIMEN}      // $0080FA
    cli                 // $0080FD

loc_0080FE:
    lda $0C             // $0080FE
    cmp #$00            // $008100
    beq loc_0080FE      // $008102

    lda $09             // $008104
    bit #$04            // $008106
    beq loc_00810E      // $008108

    inc $05             // $00810A
    inc $05             // $00810C

loc_00810E:
    bit #$08            // $00810E
    beq loc_008116      // $008110

    dec $05             // $008112
    dec $05             // $008114

loc_008116:
    lda $0B             // $008116
    bit #$04            // $008118
    beq loc_008120      // $00811A

    inc $07             // $00811C
    inc $07             // $00811E

loc_008120:
    bit #$08            // $008120
    beq loc_008128      // $008122

    dec $07             // $008124
    dec $07             // $008126

loc_008128:
    clc                 // $008128
    lda $00             // $008129
    adc $02             // $00812B
    sta $00             // $00812D
    clc                 // $00812F
    lda $01             // $008130
    adc $03             // $008132
    sta $01             // $008134
    lda $00             // $008136
    cmp #$15            // $008138
    bcs loc_008153      // $00813A

    sec                 // $00813C
    lda $05             // $00813D
    sbc #$08            // $00813F
    cmp $01             // $008141
    bcs loc_008153      // $008143

    clc                 // $008145
    adc #$28            // $008146
    cmp $01             // $008148
    bcc loc_008153      // $00814A

    sec                 // $00814C
    lda #$00            // $00814D
    sbc $02             // $00814F
    sta $02             // $008151

loc_008153:
    lda $00             // $008153
    cmp #$E6            // $008155
    bcc loc_008170      // $008157

    sec                 // $008159
    lda $07             // $00815A
    sbc #$08            // $00815C
    cmp $01             // $00815E
    bcs loc_008170      // $008160

    clc                 // $008162
    adc #$28            // $008163
    cmp $01             // $008165
    bcc loc_008170      // $008167

    sec                 // $008169
    lda #$00            // $00816A
    sbc $02             // $00816C
    sta $02             // $00816E

loc_008170:
    lda $01             // $008170
    cmp #$06            // $008172
    bcs loc_00817D      // $008174

    sec                 // $008176
    lda #$00            // $008177
    sbc $03             // $008179
    sta $03             // $00817B

loc_00817D:
    cmp #$D2            // $00817D
    bcc loc_008188      // $00817F

    sec                 // $008181
    lda #$00            // $008182
    sbc $03             // $008184
    sta $03             // $008186

loc_008188:
    lda {HVBJOY}        // $008188
    and #$80            // $00818B
    bne loc_008188      // $00818D

loc_00818F:
    lda {HVBJOY}        // $00818F
    and #$80            // $008192
    beq loc_00818F      // $008194

    jmp loc_0080FE      // $008196


nmi_008199:
    pha                 // $008199
    phx                 // $00819A
    lda #$80            // $00819B
    and {RDNMI}         // $00819D
    stz {OAMADDL}       // $0081A0
    stz {OAMADDH}       // $0081A3
    lda $00             // $0081A6
    sta {OAMDATA}       // $0081A8
    lda $01             // $0081AB
    sta {OAMDATA}       // $0081AD
    lda #$08            // $0081B0
    sta {OAMDATA}       // $0081B2
    lda #$38            // $0081B5
    sta {OAMDATA}       // $0081B7
    lda $04             // $0081BA
    sta {OAMDATA}       // $0081BC
    lda $05             // $0081BF
    sta {OAMDATA}       // $0081C1
    lda #$00            // $0081C4
    sta {OAMDATA}       // $0081C6
    lda #$38            // $0081C9
    sta {OAMDATA}       // $0081CB
    lda $06             // $0081CE
    sta {OAMDATA}       // $0081D0
    lda $07             // $0081D3
    sta {OAMDATA}       // $0081D5
    lda #$00            // $0081D8
    sta {OAMDATA}       // $0081DA
    lda #$38            // $0081DD
    sta {OAMDATA}       // $0081DF
    stz {OAMADDL}       // $0081E2
    lda #$01            // $0081E5
    sta {OAMADDH}       // $0081E7
    lda #$68            // $0081EA
    sta {OAMDATA}       // $0081EC
    lda #$55            // $0081EF
    sta {OAMDATA}       // $0081F1
    beq loc_0081F6      // $0081F4

loc_0081F6:
    lda {HVBJOY}        // $0081F6
    and #$01            // $0081F9
    beq loc_0081F6      // $0081FB

loc_0081FD:
    lda {HVBJOY}        // $0081FD
    and #$01            // $008200
    bne loc_0081FD      // $008202

    ldx {JOY1L}         // $008204
    stx $08             // $008207
    ldx {JOY2L}         // $008209
    stx $0A             // $00820C
    lda $09             // $00820E
    bit #$10            // $008210
    beq loc_00821B      // $008212

    lda $0C             // $008214
    inc                 // $008216
    and #$01            // $008217
    sta $0C             // $008219

loc_00821B:
    lda $0B             // $00821B
    bit #$10            // $00821D
    beq loc_008228      // $00821F

    lda $0C             // $008221
    inc                 // $008223
    and #$01            // $008224
    sta $0C             // $008226

loc_008228:
    plx                 // $008228
    pla                 // $008229
    rti                 // $00822A


sub_00822B:
    clc                 // $00822B
    xce                 // $00822C
    rep #$30            // $00822D
    sep #$20            // $00822F
    lda #$8F            // $008231
    sta {INIDISP}       // $008233
    ldx #$0001          // $008236

loc_008239:
    stz $2100,x         // $008239
    inx                 // $00823C
    cpx #$0015          // $00823D
    bne loc_008239      // $008240

    lda #$80            // $008242
    sta {VMAIN}         // $008244
    stz {VMADDL}        // $008247
    stz {VMADDH}        // $00824A
    stz {VMDATAL}       // $00824D
    stz {VMDATAH}       // $008250
    stz {M7SEL}         // $008253
    stz {M7A}           // $008256
    lda #$01            // $008259
    sta {M7A}           // $00825B
    stz {M7B}           // $00825E
    stz {M7B}           // $008261
    stz {M7C}           // $008264
    stz {M7C}           // $008267
    stz {M7D}           // $00826A
    sta {M7D}           // $00826D
    stz {M7X}           // $008270
    stz {M7X}           // $008273
    stz {M7Y}           // $008276
    stz {M7Y}           // $008279
    stz {CGADD}         // $00827C
    stz {CGDATA}        // $00827F
    stz {CGDATA}        // $008282
    stz {W12SEL}        // $008285
    stz {W34SEL}        // $008288
    stz {WOBJSEL}       // $00828B
    stz {WH0}           // $00828E
    stz {WH1}           // $008291
    stz {WH2}           // $008294
    stz {WH3}           // $008297
    stz {WBGLOG}        // $00829A
    stz {WOBJLOG}       // $00829D
    stz {TM}            // $0082A0
    stz {TS}            // $0082A3
    stz {TMW}           // $0082A6
    lda #$30            // $0082A9
    sta {CGWSEL}        // $0082AB
    stz {CGADSUB}       // $0082AE
    lda #$E0            // $0082B1
    sta {COLDATA}       // $0082B3
    stz {SETINI}        // $0082B6
    stz {NMITIMEN}      // $0082B9
    lda #$FF            // $0082BC
    sta {WRIO}          // $0082BE
    stz {WRMPYA}        // $0082C1
    stz {WRMPYB}        // $0082C4
    stz {WRDIVL}        // $0082C7
    stz {WRDIVH}        // $0082CA
    stz {WRDIVB}        // $0082CD
    stz {HTIMEL}        // $0082D0
    stz {HTIMEH}        // $0082D3
    stz {VTIMEL}        // $0082D6
    stz {VTIMEH}        // $0082D9
    stz {MDMAEN}        // $0082DC
    stz {HDMAEN}        // $0082DF
    stz {MEMSEL}        // $0082E2
    rts                 // $0082E5

db $00, $00, $00, $54, $A0, $02, $A0, $56, $15, $00, $15, $54, $55, $01, $B5, $56
db $4A, $29, $4A, $7D, $EA, $2B, $EA, $7F, $5F, $29, $5F, $7D, $FF, $2B, $FF, $7F
db $00, $00, $00, $54, $A0, $02, $A0, $56, $15, $00, $15, $54, $55, $01, $B5, $56
db $4A, $29, $4A, $7D, $EA, $2B, $EA, $7F, $5F, $29, $5F, $7D, $FF, $2B, $FF, $7F
db $00, $00, $00, $54, $A0, $02, $A0, $56, $15, $00, $15, $54, $55, $01, $B5, $56
db $4A, $29, $4A, $7D, $EA, $2B, $EA, $7F, $5F, $29, $5F, $7D, $FF, $2B, $FF, $7F
db $00, $00, $00, $54, $A0, $02, $A0, $56, $15, $00, $15, $54, $55, $01, $B5, $56
db $4A, $29, $4A, $7D, $EA, $2B, $EA, $7F, $5F, $29, $5F, $7D, $FF, $2B, $FF, $7F
db $00, $00, $00, $54, $A0, $02, $A0, $56, $15, $00, $15, $54, $55, $01, $B5, $56
db $4A, $29, $4A, $7D, $EA, $2B, $EA, $7F, $5F, $29, $5F, $7D, $FF, $2B, $FF, $7F
db $00, $00, $00, $54, $A0, $02, $A0, $56, $15, $00, $15, $54, $55, $01, $B5, $56
db $4A, $29, $4A, $7D, $EA, $2B, $EA, $7F, $5F, $29, $5F, $7D, $FF, $2B, $FF, $7F
db $00, $00, $00, $54, $A0, $02, $A0, $56, $15, $00, $15, $54, $55, $01, $B5, $56
db $4A, $29, $4A, $7D, $EA, $2B, $EA, $7F, $5F, $29, $5F, $7D, $FF, $2B, $FF, $7F
db $00, $00, $00, $54, $A0, $02, $A0, $56, $15, $00, $15, $54, $55, $01, $B5, $56
db $4A, $29, $4A, $7D, $EA, $2B, $EA, $7F, $5F, $29, $5F, $7D, $FF, $2B, $FF, $7F
db $00, $00, $00, $54, $20, $02, $A0, $56, $15, $00, $15, $54, $13, $02, $B5, $56
db $4A, $29, $4A, $7D, $4A, $23, $EA, $7F, $5F, $29, $5F, $7D, $FF, $2B, $FF, $7F
db $00, $00, $00, $54, $A0, $02, $A0, $56, $15, $00, $15, $54, $55, $01, $B5, $56
db $4A, $29, $4A, $7D, $EA, $2B, $EA, $7F, $5F, $29, $5F, $7D, $FF, $2B, $FF, $7F
db $00, $00, $00, $54, $A0, $02, $A0, $56, $15, $00, $15, $54, $55, $01, $B5, $56
db $4A, $29, $4A, $7D, $EA, $2B, $EA, $7F, $5F, $29, $5F, $7D, $FF, $2B, $FF, $7F
db $00, $00, $00, $54, $A0, $02, $A0, $56, $15, $00, $15, $54, $55, $01, $B5, $56
db $4A, $29, $4A, $7D, $EA, $2B, $EA, $7F, $5F, $29, $5F, $7D, $FF, $2B, $FF, $7F
db $00, $00, $00, $54, $A0, $02, $A0, $56, $15, $00, $15, $54, $55, $01, $B5, $56
db $4A, $29, $4A, $7D, $EA, $2B, $EA, $7F, $5F, $29, $5F, $7D, $FF, $2B, $FF, $7F
db $00, $00, $00, $54, $A0, $02, $A0, $56, $15, $00, $15, $54, $55, $01, $B5, $56
db $4A, $29, $4A, $7D, $EA, $2B, $EA, $7F, $5F, $29, $5F, $7D, $FF, $2B, $FF, $7F
db $00, $00, $00, $54, $A0, $02, $A0, $56, $15, $00, $15, $54, $55, $01, $B5, $56
db $4A, $29, $4A, $7D, $EA, $2B, $EA, $7F, $5F, $29, $5F, $7D, $FF, $2B, $FF, $7F
db $00, $00, $00, $54, $A0, $02, $A0, $56, $15, $00, $15, $54, $55, $01, $B5, $56
db $4A, $29, $4A, $7D, $EA, $2B, $EA, $7F, $5F, $29, $5F, $7D, $FF, $2B, $FF, $7F
db $80, $00, $40, $00, $20, $00, $10, $00, $08, $00, $04, $00, $02, $00, $01, $00
db $00, $00, $00, $00, $00, $00, $00, $00, $00, $00, $00, $00, $00, $00, $00, $00
db $01, $00, $02, $00, $04, $00, $08, $00, $10, $00, $20, $00, $40, $00, $80

fill 35, $00

db $07, $07, $0F, $08, $1C, $13, $38, $20, $70, $40, $60, $50, $60, $50, $00, $00
db $00, $00, $00, $00, $00, $00, $00, $00, $00, $00, $00, $00, $00, $00, $00, $00
db $80, $80, $E0, $00, $F0, $00, $70, $00, $30, $28, $30, $28, $30, $28

fill 384, $00

db $01, $00, $02, $00, $04, $00, $08, $00, $10, $00, $20, $00, $40, $00, $80, $00
db $00, $00, $00, $00, $00, $00, $00, $00, $00, $00, $00, $00, $00, $00, $00, $00
db $80, $00, $40, $00, $20, $00, $10, $00, $08, $00, $04, $00, $02, $00, $01

fill 33, $00

db $60, $50, $7F, $4F, $7F, $40, $60, $5F, $60, $50, $60, $50, $60, $50, $00, $00
db $00, $00, $00, $00, $00, $00, $00, $00, $00, $00, $00, $00, $00, $00, $00, $00
db $60, $50, $E0, $90, $98, $7C, $36, $A0, $66, $45, $6E, $49, $38, $06, $00, $00
db $00, $00, $00, $00, $00, $00, $00, $00, $00, $00, $00, $00, $00, $00, $00, $00
db $00, $00, $01, $01, $33, $32, $33, $22, $6A, $53, $4E, $61, $46, $41, $00, $00
db $00, $00, $00, $00, $00, $00, $00, $00, $00, $00, $00, $00, $00, $00, $00, $00
db $00, $00, $1C, $14, $36, $A0, $30, $A0, $76, $45, $62, $51, $3C, $22, $04, $02

fill 448, $00

db $02, $00, $04, $00, $02, $00, $04, $00, $02, $00, $04, $00, $02, $00, $04, $00
db $02, $00, $04, $00, $02, $00, $04, $00, $02, $00, $04, $00, $02, $00, $04, $00
db $02, $00, $04, $00, $02, $00, $04

fill 1593, $00

db $FF, $FF, $80, $FF, $80, $FF, $80, $FF, $80, $FF, $80, $FF, $80, $FF, $80, $FF
db $FF, $FF, $80, $FE, $80, $FE, $80, $FE, $80, $FE, $80, $FE, $80, $FE, $80, $FE

fill 90, $00

db $3E, $1C, $3E, $3E, $36, $36, $00, $00, $00, $00, $00, $00, $00, $00, $00, $00
db $00, $00, $00, $00, $00, $00, $00, $00, $00, $00, $00, $00, $00, $00, $00, $00
db $FB, $73, $FB, $FB, $DB, $DA, $00, $00, $00, $00, $00, $00, $00, $00, $00, $00
db $00, $00, $00, $00, $00, $00, $00, $00, $00, $00, $00, $00, $00, $00, $00, $00
db $6F, $47, $6F, $6E, $6E, $6C, $00, $00, $00, $00, $00, $00, $00, $00, $00, $00
db $00, $00, $00, $00, $00, $00, $00, $00, $00, $00, $00, $00, $00, $00, $00, $00
db $BE, $BE, $BE, $30, $38, $30, $10, $18, $70, $7E, $60, $FF, $C0, $FF, $80, $FF
db $00, $7E, $00, $7E, $00, $18, $18, $18, $7E, $7E, $FF, $7E, $FF, $FE, $FF, $FE
db $7E, $78, $7E, $40, $18

fill 257, $00

db $80, $FF, $80, $FF, $80, $FF, $80, $FF, $80, $FF, $80, $FF, $80, $FF, $80, $FF
db $80, $FE, $80, $FE, $80, $FE, $80, $FE, $80, $FE, $80, $FE, $80, $FE, $80, $FE

fill 80, $00

db $3E, $3E, $3E, $3C, $30, $20, $30, $30, $00, $00, $00, $00, $00, $00, $00, $00
db $00, $00, $00, $00, $00, $00, $00, $00, $00, $00, $00, $00, $00, $00, $00, $00
db $FB, $FA, $FB, $DA, $DB, $DB, $D9, $91, $00, $00, $00, $00, $00, $00, $00, $00
db $00, $00, $00, $00, $00, $00, $00, $00, $00, $00, $00, $00, $00, $00, $00, $00
db $6F, $47, $63, $43, $EF, $CF, $EF, $80, $00, $00, $00, $00, $00, $00, $00, $00
db $00, $00, $00, $00, $00, $00, $00, $00, $00, $00, $00, $00, $00, $00, $00, $00
db $BC, $38, $B8, $B0, $BE, $3E, $3E

fill 297, $00

db $80, $FF, $80, $FF, $80, $FF, $80, $FF, $80, $FF, $80, $FF, $80, $FF, $80, $FF
db $80, $FE, $80, $FE, $80, $FE, $80, $FE, $80, $FE, $80, $FE, $80, $FE, $80, $FE

fill 480, $00

db $80, $FF, $80, $FF, $80, $FF, $80, $FF, $80, $FF, $80, $FF, $80, $FF, $80, $FF
db $80, $FE, $80, $FE, $80, $FE, $80, $FE, $80, $FE, $80, $FE, $80, $FE, $80, $80

fill 27098, $00

db $53, $55, $50, $45, $52, $20, $50, $4F, $4E, $47, $21, $20, $2D, $42, $45, $54
db $41, $2D, $00, $00, $00, $00, $00, $09, $00, $01, $00, $00, $00, $00, $00, $00
db $00, $00, $00, $00, $00, $00, $00, $00, $00, $00, $99, $81, $00, $80, $00, $00
db $00, $00, $00, $00, $00, $00, $00, $00, $00, $00, $99, $81, $00, $80, $00, $00

